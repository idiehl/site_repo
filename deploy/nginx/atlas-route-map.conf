# Atlas Universalis — Route Backend Maps
# Location: /etc/nginx/conf.d/atlas-route-map.conf
#
# These map variables control blue/green routing per subdomain.
# DEFAULT: all traffic goes to "atlas_legacy" (no traffic change).
#
# To cut over a subdomain, change its default from "atlas_legacy" to the
# corresponding "atlas_dotnet_*" upstream name, then `sudo nginx -s reload`.
# To roll back, reverse the change and reload again.

# Phase 2: Main site backend selection
# Change "atlas_legacy" → "atlas_dotnet_web" to cut over
map $request_uri $main_backend {
    default atlas_legacy;
}

# Phase 3: Apply frontend backend selection
# Change "atlas_legacy" → "atlas_dotnet_apply" to cut over
map $request_uri $apply_frontend_backend {
    default atlas_legacy;
}

# Phase 6: Apply API backend selection
# Change "atlas_legacy" → "atlas_dotnet_apply" to cut over
map $request_uri $apply_api_backend {
    default atlas_legacy;
}

# Phase 4: Forge backend selection
# Change "atlas_legacy" → "atlas_dotnet_forge" to cut over
map $request_uri $forge_backend {
    default atlas_legacy;
}
