import{u as R,r as u,x as T,m as $,c as o,a as t,h as b,i as f,j as z,t as a,f as O,e as Y,C as q,d as h,F as p,n as m,k as G,s as F,o as n,g as y,p as H}from"./index-tJy5BnYm.js";const J={class:"min-h-screen bg-night-950"},K={class:"bg-night-900/50 border-b border-night-800"},Q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},W={class:"flex items-center justify-between h-16"},X={class:"flex items-center gap-4"},Z={class:"hidden md:flex items-center gap-1"},tt={class:"flex items-center gap-4"},st={class:"text-sm text-night-400"},et={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ot={key:0,class:"card bg-red-900/20 border-red-800"},nt={key:1},at={class:"card mb-6"},lt={class:"flex items-center gap-4"},it=["disabled"],dt={key:0,class:"card"},rt={key:1,class:"card bg-red-900/20 border-red-800"},ct={class:"text-red-400"},ut={key:2},ht={class:"card mb-6"},pt={key:0,class:"mb-6"},mt={class:"space-y-2"},xt={class:"text-sm font-mono text-night-300"},_t={class:"text-sm font-bold text-atlas-400"},gt={key:1,class:"mb-6"},vt={class:"space-y-2"},bt={class:"text-sm text-night-300"},ft={class:"text-sm font-bold text-purple-400"},yt={key:2},kt={class:"overflow-x-auto"},wt={class:"w-full text-sm"},At={class:"p-2 font-mono text-xs"},Vt={class:"p-2"},Ct={class:"p-2 text-xs"},Lt={class:"p-2 text-xs"},Pt={class:"p-2 text-xs"},St={class:"card"},Dt={key:0,class:"mb-6"},Ut={class:"overflow-x-auto"},jt={class:"w-full text-sm"},Et={class:"p-2 font-mono text-xs"},Ft={class:"p-2"},Mt={class:"p-2 text-right"},Nt={class:"p-2 text-right"},Bt={key:1,class:"mb-6"},It={class:"space-y-2"},Rt={class:"text-sm text-night-300"},Tt={class:"flex items-center gap-4"},$t={class:"text-sm text-blue-400"},zt={class:"text-sm text-night-500"},qt={__name:"AdminAnalyticsView",setup(Ot){const M=G(),g=R();function N(){g.logout(),M.push({name:"login"})}const x=u(!0),d=u(null),r=u(null),c=u(null),_=u(7),k=T(()=>{var i;return((i=g.user)==null?void 0:i.is_admin)===!0});async function B(){var i,s;try{const l=await F.get("/api/v1/admin/analytics/visits",{params:{days:_.value,limit:100}});d.value=l.data}catch(l){c.value=((s=(i=l.response)==null?void 0:i.data)==null?void 0:s.detail)||"Failed to load visits"}}async function I(){var i,s;try{const l=await F.get("/api/v1/admin/analytics/api-usage",{params:{days:_.value,limit:100}});r.value=l.data}catch(l){c.value=((s=(i=l.response)==null?void 0:i.data)==null?void 0:s.detail)||"Failed to load API usage"}}async function v(){x.value=!0,c.value=null,await Promise.all([B(),I()]),x.value=!1}return $(()=>{k.value&&v()}),(i,s)=>{var w,A,V,C,L,P,S,D,U,j,E;const l=z("router-link");return n(),o("div",J,[t("header",K,[t("div",Q,[t("div",W,[t("div",X,[s[4]||(s[4]=t("h1",{class:"text-xl font-bold text-atlas-400"},"Analytics",-1)),t("nav",Z,[b(l,{to:"/admin",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-400 hover:text-night-100 hover:bg-night-800/50"},{default:f(()=>[...s[1]||(s[1]=[y(" Overview ",-1)])]),_:1}),b(l,{to:"/admin/analytics",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-100 bg-night-800"},{default:f(()=>[...s[2]||(s[2]=[y(" Analytics ",-1)])]),_:1}),b(l,{to:"/admin/security",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-400 hover:text-night-100 hover:bg-night-800/50"},{default:f(()=>[...s[3]||(s[3]=[y(" Security ",-1)])]),_:1})])]),t("div",tt,[t("span",st,a((w=O(g).user)==null?void 0:w.email),1),t("button",{onClick:N,class:"btn btn-ghost text-sm"}," Logout ")])])])]),t("main",et,[k.value?(n(),o("div",nt,[t("div",at,[t("div",lt,[s[7]||(s[7]=t("label",{class:"text-sm text-night-400"},"Period:",-1)),Y(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),onChange:v,class:"input"},[...s[6]||(s[6]=[t("option",{value:7},"Last 7 days",-1),t("option",{value:30},"Last 30 days",-1),t("option",{value:90},"Last 90 days",-1)])],544),[[q,_.value]]),t("button",{onClick:v,class:"btn btn-primary",disabled:x.value}," Refresh ",8,it)])]),x.value?(n(),o("div",dt,[...s[8]||(s[8]=[t("p",{class:"text-night-400"},"Loading analytics...",-1)])])):c.value?(n(),o("div",rt,[t("p",ct,a(c.value),1)])):(n(),o("div",ut,[t("div",ht,[s[13]||(s[13]=t("h2",{class:"text-xl font-bold mb-4"},"Site Visits",-1)),(V=(A=d.value)==null?void 0:A.popular_paths)!=null&&V.length?(n(),o("div",pt,[s[9]||(s[9]=t("h3",{class:"text-lg font-semibold mb-3"},"Popular Paths",-1)),t("div",mt,[(n(!0),o(p,null,m(d.value.popular_paths,e=>(n(),o("div",{key:e.path,class:"flex items-center justify-between p-2 bg-night-800 rounded"},[t("span",xt,a(e.path),1),t("span",_t,a(e.count),1)]))),128))])])):h("",!0),(L=(C=d.value)==null?void 0:C.visits_by_day)!=null&&L.length?(n(),o("div",gt,[s[10]||(s[10]=t("h3",{class:"text-lg font-semibold mb-3"},"Visits by Day",-1)),t("div",vt,[(n(!0),o(p,null,m(d.value.visits_by_day,e=>(n(),o("div",{key:e.date,class:"flex items-center justify-between p-2 bg-night-800 rounded"},[t("span",bt,a(e.date),1),t("span",ft,a(e.count),1)]))),128))])])):h("",!0),(S=(P=d.value)==null?void 0:P.recent_visits)!=null&&S.length?(n(),o("div",yt,[s[12]||(s[12]=t("h3",{class:"text-lg font-semibold mb-3"},"Recent Visits",-1)),t("div",kt,[t("table",wt,[s[11]||(s[11]=t("thead",null,[t("tr",{class:"border-b border-night-800"},[t("th",{class:"text-left p-2"},"Path"),t("th",{class:"text-left p-2"},"Method"),t("th",{class:"text-left p-2"},"IP"),t("th",{class:"text-left p-2"},"User"),t("th",{class:"text-left p-2"},"Time")])],-1)),t("tbody",null,[(n(!0),o(p,null,m(d.value.recent_visits.slice(0,20),e=>(n(),o("tr",{key:e.id,class:"border-b border-night-800/50"},[t("td",At,a(e.path),1),t("td",Vt,a(e.method),1),t("td",Ct,a(e.ip_address||"-"),1),t("td",Lt,a(e.user_id||"Anonymous"),1),t("td",Pt,a(new Date(e.created_at).toLocaleString()),1)]))),128))])])])])):h("",!0)]),t("div",St,[s[17]||(s[17]=t("h2",{class:"text-xl font-bold mb-4"},"API Usage",-1)),(U=(D=r.value)==null?void 0:D.endpoint_stats)!=null&&U.length?(n(),o("div",Dt,[s[15]||(s[15]=t("h3",{class:"text-lg font-semibold mb-3"},"Endpoint Statistics",-1)),t("div",Ut,[t("table",jt,[s[14]||(s[14]=t("thead",null,[t("tr",{class:"border-b border-night-800"},[t("th",{class:"text-left p-2"},"Endpoint"),t("th",{class:"text-left p-2"},"Method"),t("th",{class:"text-right p-2"},"Calls"),t("th",{class:"text-right p-2"},"Avg Time (ms)"),t("th",{class:"text-right p-2"},"Errors")])],-1)),t("tbody",null,[(n(!0),o(p,null,m(r.value.endpoint_stats,e=>(n(),o("tr",{key:`${e.endpoint}-${e.method}`,class:"border-b border-night-800/50"},[t("td",Et,a(e.endpoint),1),t("td",Ft,a(e.method),1),t("td",Mt,a(e.count),1),t("td",Nt,a(e.avg_response_time_ms),1),t("td",{class:H(["p-2 text-right",e.error_count>0?"text-red-400":""])},a(e.error_count),3)]))),128))])])])])):h("",!0),(E=(j=r.value)==null?void 0:j.usage_by_day)!=null&&E.length?(n(),o("div",Bt,[s[16]||(s[16]=t("h3",{class:"text-lg font-semibold mb-3"},"Usage by Day",-1)),t("div",It,[(n(!0),o(p,null,m(r.value.usage_by_day,e=>(n(),o("div",{key:e.date,class:"flex items-center justify-between p-2 bg-night-800 rounded"},[t("span",Rt,a(e.date),1),t("div",Tt,[t("span",$t,a(e.count)+" calls",1),t("span",zt,a(e.avg_response_time_ms)+"ms avg",1)])]))),128))])])):h("",!0)])]))])):(n(),o("div",ot,[...s[5]||(s[5]=[t("h2",{class:"text-xl font-bold text-red-400 mb-2"},"Access Denied",-1),t("p",{class:"text-night-300"},"You do not have admin privileges.",-1)])]))])])}}};export{qt as default};
