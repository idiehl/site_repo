import{u as I,r as u,x as T,m as R,c as o,a as t,h as b,i as f,j as $,t as l,f as y,e as z,C as O,d as p,F as m,n as h,s as M,o as n,g as k,p as Y}from"./index-CsHBq9cG.js";const q={class:"min-h-screen bg-night-950"},G={class:"bg-night-900/50 border-b border-night-800"},H={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},J={class:"flex items-center justify-between h-16"},K={class:"flex items-center gap-4"},Q={class:"hidden md:flex items-center gap-1"},W={class:"flex items-center gap-4"},X={class:"text-sm text-night-400"},Z={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},tt={key:0,class:"card bg-red-900/20 border-red-800"},st={key:1},et={class:"card mb-6"},ot={class:"flex items-center gap-4"},nt=["disabled"],lt={key:0,class:"card"},at={key:1,class:"card bg-red-900/20 border-red-800"},it={class:"text-red-400"},dt={key:2},rt={class:"card mb-6"},ct={key:0,class:"mb-6"},ut={class:"space-y-2"},pt={class:"text-sm font-mono text-night-300"},mt={class:"text-sm font-bold text-atlas-400"},ht={key:1,class:"mb-6"},xt={class:"space-y-2"},_t={class:"text-sm text-night-300"},gt={class:"text-sm font-bold text-purple-400"},vt={key:2},bt={class:"overflow-x-auto"},ft={class:"w-full text-sm"},yt={class:"p-2 font-mono text-xs"},kt={class:"p-2"},wt={class:"p-2 text-xs"},At={class:"p-2 text-xs"},Vt={class:"p-2 text-xs"},Ct={class:"card"},Pt={key:0,class:"mb-6"},Lt={class:"overflow-x-auto"},St={class:"w-full text-sm"},Dt={class:"p-2 font-mono text-xs"},Ut={class:"p-2"},jt={class:"p-2 text-right"},Et={class:"p-2 text-right"},Ft={key:1,class:"mb-6"},Mt={class:"space-y-2"},Nt={class:"text-sm text-night-300"},Bt={class:"flex items-center gap-4"},It={class:"text-sm text-blue-400"},Tt={class:"text-sm text-night-500"},zt={__name:"AdminAnalyticsView",setup(Rt){const x=I(),_=u(!0),d=u(null),r=u(null),c=u(null),g=u(7),w=T(()=>{var i;return((i=x.user)==null?void 0:i.is_admin)===!0});async function N(){var i,s;try{const a=await M.get("/api/v1/admin/analytics/visits",{params:{days:g.value,limit:100}});d.value=a.data}catch(a){c.value=((s=(i=a.response)==null?void 0:i.data)==null?void 0:s.detail)||"Failed to load visits"}}async function B(){var i,s;try{const a=await M.get("/api/v1/admin/analytics/api-usage",{params:{days:g.value,limit:100}});r.value=a.data}catch(a){c.value=((s=(i=a.response)==null?void 0:i.data)==null?void 0:s.detail)||"Failed to load API usage"}}async function v(){_.value=!0,c.value=null,await Promise.all([N(),B()]),_.value=!1}return R(()=>{w.value&&v()}),(i,s)=>{var A,V,C,P,L,S,D,U,j,E,F;const a=$("router-link");return n(),o("div",q,[t("header",G,[t("div",H,[t("div",J,[t("div",K,[s[5]||(s[5]=t("h1",{class:"text-xl font-bold text-atlas-400"},"Analytics",-1)),t("nav",Q,[b(a,{to:"/admin",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-400 hover:text-night-100 hover:bg-night-800/50"},{default:f(()=>[...s[2]||(s[2]=[k(" Overview ",-1)])]),_:1}),b(a,{to:"/admin/analytics",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-100 bg-night-800"},{default:f(()=>[...s[3]||(s[3]=[k(" Analytics ",-1)])]),_:1}),b(a,{to:"/admin/security",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-400 hover:text-night-100 hover:bg-night-800/50"},{default:f(()=>[...s[4]||(s[4]=[k(" Security ",-1)])]),_:1})])]),t("div",W,[t("span",X,l((A=y(x).user)==null?void 0:A.email),1),t("button",{onClick:s[0]||(s[0]=(...e)=>y(x).logout&&y(x).logout(...e)),class:"btn btn-ghost text-sm"}," Logout ")])])])]),t("main",Z,[w.value?(n(),o("div",st,[t("div",et,[t("div",ot,[s[8]||(s[8]=t("label",{class:"text-sm text-night-400"},"Period:",-1)),z(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>g.value=e),onChange:v,class:"input"},[...s[7]||(s[7]=[t("option",{value:7},"Last 7 days",-1),t("option",{value:30},"Last 30 days",-1),t("option",{value:90},"Last 90 days",-1)])],544),[[O,g.value]]),t("button",{onClick:v,class:"btn btn-primary",disabled:_.value}," Refresh ",8,nt)])]),_.value?(n(),o("div",lt,[...s[9]||(s[9]=[t("p",{class:"text-night-400"},"Loading analytics...",-1)])])):c.value?(n(),o("div",at,[t("p",it,l(c.value),1)])):(n(),o("div",dt,[t("div",rt,[s[14]||(s[14]=t("h2",{class:"text-xl font-bold mb-4"},"Site Visits",-1)),(C=(V=d.value)==null?void 0:V.popular_paths)!=null&&C.length?(n(),o("div",ct,[s[10]||(s[10]=t("h3",{class:"text-lg font-semibold mb-3"},"Popular Paths",-1)),t("div",ut,[(n(!0),o(m,null,h(d.value.popular_paths,e=>(n(),o("div",{key:e.path,class:"flex items-center justify-between p-2 bg-night-800 rounded"},[t("span",pt,l(e.path),1),t("span",mt,l(e.count),1)]))),128))])])):p("",!0),(L=(P=d.value)==null?void 0:P.visits_by_day)!=null&&L.length?(n(),o("div",ht,[s[11]||(s[11]=t("h3",{class:"text-lg font-semibold mb-3"},"Visits by Day",-1)),t("div",xt,[(n(!0),o(m,null,h(d.value.visits_by_day,e=>(n(),o("div",{key:e.date,class:"flex items-center justify-between p-2 bg-night-800 rounded"},[t("span",_t,l(e.date),1),t("span",gt,l(e.count),1)]))),128))])])):p("",!0),(D=(S=d.value)==null?void 0:S.recent_visits)!=null&&D.length?(n(),o("div",vt,[s[13]||(s[13]=t("h3",{class:"text-lg font-semibold mb-3"},"Recent Visits",-1)),t("div",bt,[t("table",ft,[s[12]||(s[12]=t("thead",null,[t("tr",{class:"border-b border-night-800"},[t("th",{class:"text-left p-2"},"Path"),t("th",{class:"text-left p-2"},"Method"),t("th",{class:"text-left p-2"},"IP"),t("th",{class:"text-left p-2"},"User"),t("th",{class:"text-left p-2"},"Time")])],-1)),t("tbody",null,[(n(!0),o(m,null,h(d.value.recent_visits.slice(0,20),e=>(n(),o("tr",{key:e.id,class:"border-b border-night-800/50"},[t("td",yt,l(e.path),1),t("td",kt,l(e.method),1),t("td",wt,l(e.ip_address||"-"),1),t("td",At,l(e.user_id||"Anonymous"),1),t("td",Vt,l(new Date(e.created_at).toLocaleString()),1)]))),128))])])])])):p("",!0)]),t("div",Ct,[s[18]||(s[18]=t("h2",{class:"text-xl font-bold mb-4"},"API Usage",-1)),(j=(U=r.value)==null?void 0:U.endpoint_stats)!=null&&j.length?(n(),o("div",Pt,[s[16]||(s[16]=t("h3",{class:"text-lg font-semibold mb-3"},"Endpoint Statistics",-1)),t("div",Lt,[t("table",St,[s[15]||(s[15]=t("thead",null,[t("tr",{class:"border-b border-night-800"},[t("th",{class:"text-left p-2"},"Endpoint"),t("th",{class:"text-left p-2"},"Method"),t("th",{class:"text-right p-2"},"Calls"),t("th",{class:"text-right p-2"},"Avg Time (ms)"),t("th",{class:"text-right p-2"},"Errors")])],-1)),t("tbody",null,[(n(!0),o(m,null,h(r.value.endpoint_stats,e=>(n(),o("tr",{key:`${e.endpoint}-${e.method}`,class:"border-b border-night-800/50"},[t("td",Dt,l(e.endpoint),1),t("td",Ut,l(e.method),1),t("td",jt,l(e.count),1),t("td",Et,l(e.avg_response_time_ms),1),t("td",{class:Y(["p-2 text-right",e.error_count>0?"text-red-400":""])},l(e.error_count),3)]))),128))])])])])):p("",!0),(F=(E=r.value)==null?void 0:E.usage_by_day)!=null&&F.length?(n(),o("div",Ft,[s[17]||(s[17]=t("h3",{class:"text-lg font-semibold mb-3"},"Usage by Day",-1)),t("div",Mt,[(n(!0),o(m,null,h(r.value.usage_by_day,e=>(n(),o("div",{key:e.date,class:"flex items-center justify-between p-2 bg-night-800 rounded"},[t("span",Nt,l(e.date),1),t("div",Bt,[t("span",It,l(e.count)+" calls",1),t("span",Tt,l(e.avg_response_time_ms)+"ms avg",1)])]))),128))])])):p("",!0)])]))])):(n(),o("div",tt,[...s[6]||(s[6]=[t("h2",{class:"text-xl font-bold text-red-400 mb-2"},"Access Denied",-1),t("p",{class:"text-night-300"},"You do not have admin privileges.",-1)])]))])])}}};export{zt as default};
