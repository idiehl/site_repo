import{u as V,r as c,x as D,m as R,c as l,a as t,h as g,i as _,j as N,t as n,f as U,e as w,C as k,b as F,F as B,n as M,s as S,k as O,o as a,g as y,p as f}from"./index-tJy5BnYm.js";const T={class:"min-h-screen bg-night-950"},j={class:"bg-night-900/50 border-b border-night-800"},$={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},z={class:"flex items-center justify-between h-16"},H={class:"flex items-center gap-4"},I={class:"hidden md:flex items-center gap-1"},P={class:"flex items-center gap-4"},Y={class:"text-sm text-night-400"},q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},G={key:0,class:"card bg-red-900/20 border-red-800"},J={key:1},K={class:"card mb-6"},Q={class:"flex items-center gap-4 flex-wrap"},W=["disabled"],X={key:0,class:"card"},Z={key:1,class:"card bg-red-900/20 border-red-800"},tt={class:"text-red-400"},et={key:2,class:"card"},st={key:3,class:"card"},ot={class:"overflow-x-auto"},lt={class:"w-full text-sm"},at={class:"p-2 font-mono text-xs"},nt={class:"p-2"},it={class:"p-2 text-xs"},dt={class:"p-2 text-xs"},rt={class:"p-2 text-xs"},ut={class:"p-2"},ct={class:"p-2"},pt=["onClick"],xt={key:1,class:"text-xs text-night-500"},gt={__name:"AdminSecurityView",setup(vt){const C=O(),m=V();function A(){m.logout(),C.push({name:"login"})}const p=c(!0),h=c([]),r=c(null),x=c(null),v=c(null),b=D(()=>{var i;return((i=m.user)==null?void 0:i.is_admin)===!0}),E={low:"text-blue-400",medium:"text-yellow-400",high:"text-orange-400",critical:"text-red-400"};async function u(){var i,e;p.value=!0,r.value=null;try{const o={};x.value!==null&&(o.resolved=x.value),v.value&&(o.severity=v.value);const d=await S.get("/api/v1/admin/security/events",{params:o});h.value=d.data.events||[]}catch(o){r.value=((e=(i=o.response)==null?void 0:i.data)==null?void 0:e.detail)||"Failed to load security events"}finally{p.value=!1}}async function L(i){var e,o;try{await S.post(`/api/v1/admin/security/events/${i}/resolve`),await u()}catch(d){r.value=((o=(e=d.response)==null?void 0:e.data)==null?void 0:o.detail)||"Failed to resolve event"}}return R(()=>{b.value&&u()}),(i,e)=>{var d;const o=N("router-link");return a(),l("div",T,[t("header",j,[t("div",$,[t("div",z,[t("div",H,[e[5]||(e[5]=t("h1",{class:"text-xl font-bold text-atlas-400"},"Security Events",-1)),t("nav",I,[g(o,{to:"/admin",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-400 hover:text-night-100 hover:bg-night-800/50"},{default:_(()=>[...e[2]||(e[2]=[y(" Overview ",-1)])]),_:1}),g(o,{to:"/admin/analytics",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-400 hover:text-night-100 hover:bg-night-800/50"},{default:_(()=>[...e[3]||(e[3]=[y(" Analytics ",-1)])]),_:1}),g(o,{to:"/admin/security",class:"px-3 py-2 rounded-lg text-sm font-medium text-night-100 bg-night-800"},{default:_(()=>[...e[4]||(e[4]=[y(" Security ",-1)])]),_:1})])]),t("div",P,[t("span",Y,n((d=U(m).user)==null?void 0:d.email),1),t("button",{onClick:A,class:"btn btn-ghost text-sm"}," Logout ")])])])]),t("main",q,[b.value?(a(),l("div",J,[t("div",K,[t("div",Q,[e[9]||(e[9]=t("label",{class:"text-sm text-night-400"},"Status:",-1)),w(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),onChange:u,class:"input"},[...e[7]||(e[7]=[t("option",{value:null},"All",-1),t("option",{value:!1},"Unresolved",-1),t("option",{value:!0},"Resolved",-1)])],544),[[k,x.value]]),e[10]||(e[10]=t("label",{class:"text-sm text-night-400 ml-4"},"Severity:",-1)),w(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),onChange:u,class:"input"},[...e[8]||(e[8]=[F('<option value="">All</option><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option><option value="critical">Critical</option>',5)])],544),[[k,v.value]]),t("button",{onClick:u,class:"btn btn-primary",disabled:p.value}," Refresh ",8,W)])]),p.value?(a(),l("div",X,[...e[11]||(e[11]=[t("p",{class:"text-night-400"},"Loading security events...",-1)])])):r.value?(a(),l("div",Z,[t("p",tt,n(r.value),1)])):h.value.length===0?(a(),l("div",et,[...e[12]||(e[12]=[t("p",{class:"text-night-400"},"No security events found.",-1)])])):(a(),l("div",st,[e[14]||(e[14]=t("h2",{class:"text-xl font-bold mb-4"},"Security Events",-1)),t("div",ot,[t("table",lt,[e[13]||(e[13]=t("thead",null,[t("tr",{class:"border-b border-night-800"},[t("th",{class:"text-left p-2"},"Type"),t("th",{class:"text-left p-2"},"Severity"),t("th",{class:"text-left p-2"},"IP Address"),t("th",{class:"text-left p-2"},"User"),t("th",{class:"text-left p-2"},"Time"),t("th",{class:"text-left p-2"},"Status"),t("th",{class:"text-left p-2"},"Actions")])],-1)),t("tbody",null,[(a(!0),l(B,null,M(h.value,s=>(a(),l("tr",{key:s.id,class:f(["border-b border-night-800/50",s.severity==="critical"&&!s.resolved?"bg-red-900/10":""])},[t("td",at,n(s.event_type),1),t("td",nt,[t("span",{class:f(E[s.severity]||"text-night-400")},n(s.severity.toUpperCase()),3)]),t("td",it,n(s.ip_address||"-"),1),t("td",dt,n(s.user_id||"Anonymous"),1),t("td",rt,n(new Date(s.created_at).toLocaleString()),1),t("td",ut,[t("span",{class:f([s.resolved?"text-green-400":"text-yellow-400","text-xs font-semibold"])},n(s.resolved?"RESOLVED":"UNRESOLVED"),3)]),t("td",ct,[s.resolved?(a(),l("span",xt,n(s.resolved_at?new Date(s.resolved_at).toLocaleDateString():""),1)):(a(),l("button",{key:0,onClick:mt=>L(s.id),class:"btn btn-sm btn-primary"}," Resolve ",8,pt))])],2))),128))])])])]))])):(a(),l("div",G,[...e[6]||(e[6]=[t("h2",{class:"text-xl font-bold text-red-400 mb-2"},"Access Denied",-1),t("p",{class:"text-night-300"},"You do not have admin privileges.",-1)])]))])])}}};export{gt as default};
