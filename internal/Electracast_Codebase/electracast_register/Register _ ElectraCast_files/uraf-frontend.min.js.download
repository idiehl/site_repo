jQuery(function(f){var e=function(){if("undefined"==typeof user_registration_params)return!1;f(document).on("user_registration_frontend_form_data_render",function(e,r,t){"input"===r.get(0).tagName.toLowerCase()&&r.hasClass(".uraf-profile-picture-input")&&"undefined"!==r.val()&&0<r.val()&&(t.value=r.val())});var a={init:function(){f(document).ready(a.ready),this.load_validation(),this.init_event()},ready:function(){a.loadPhoneField()},load_validation:function(){if("undefined"==typeof f.fn.validate)return!1},loadPhoneField:function(){var e,r="",i={};if("undefined"==typeof f.fn.intlTelInput)return!1;"yes"!==user_registration_params.disable_user_details&&(i.geoIpLookup=a.currentIpToCountry),"yes"===user_registration_params.disable_user_details&&(e=this.getFirstBrowserLanguage(),r=-1<e.indexOf("-")?e.split("-").pop():""),r&&(e=window.intlTelInputGlobals.getCountryData(),r=(e=e.filter(function(e){return e.iso2===r.toLowerCase()})).length?r:""),i.initialCountry="yes"===user_registration_params.disable_user_details&&r?r:"auto",f(".ur-smart-phone-field").each(function(e,r){var t=f(r);i.hiddenInput=t.data("id"),i.utilsScript=user_registration_advanced_fields_params.utils_url,t.intlTelInput(i),t.blur(function(){var e,r=t.closest(".form-row");t.intlTelInput("isValidNumber")?(t.siblings('input[type="hidden"]').val(t.intlTelInput("getNumber")),r.find("#"+t.data("id")).attr("aria-invalid",!1),r.find("#"+t.data("id")+"-error").remove()):""!==t.val()&&(r.find("#"+t.data("id")+"-error").remove(),e='<label id="'+t.data("id")+'-error" class="user-registration-error" for="'+t.data("id")+'">'+user_registration_params.message_validate_phone_number+"</label>",r.append(e),r.find("#"+t.data("id")).attr("aria-invalid",!0))})})},getFirstBrowserLanguage:function(){var e,r,t=window.navigator,i=["language","browserLanguage","systemLanguage","userLanguage"];if(Array.isArray(t.languages))for(e=0;e<t.languages.length;e++)if((r=t.languages[e])&&r.length)return r;for(e=0;e<i.length;e++)if((r=t[i[e]])&&r.length)return r;return""},currentIpToCountry:function(t){f.get("https://ipapi.co/json").always(function(e){var r=e&&e.country?e.country:"";r||(r=-1<(e=a.getFirstBrowserLanguage()).indexOf("-")?e.split("-").pop():""),t(r)})},dataURItoBlob:function(e){for(var r=(0<=e.split(",")[0].indexOf("base64")?atob:unescape)(e.split(",")[1]),e=e.split(",")[0].split(":")[1].split(";")[0],t=new Uint8Array(r.length),i=0;i<r.length;i++)t[i]=r.charCodeAt(i);return new Blob([t],{type:e})},send_file:function(o,e){var r=user_registration_advanced_fields_params.ajax_url+"?action=uraf_profile_picture_upload_method_upload&security="+user_registration_advanced_fields_params.uraf_profile_picture_upload_nonce,t=new FormData;f("#ur-profile-pic").data("crop-picture")&&(e=f("#crop_container").attr("src"),t.append("cropped_image",f(".cropped_image_size").val())),o[0].files[0]?t.append("file",o[0].files[0]):""!==e&&(e=a.dataURItoBlob(e),e=new File([e],"snapshot.jpg"),t.append("file",e),t.append("is_snapshot",!0)),t.append("form_id",f(".ur-frontend-form form").data("form-id"));var s=o.closest(".uraf-profile-picture-upload").find(".wp_uraf_profile_picture_upload"),l=s.text();f.ajax({url:r,data:t,type:"POST",processData:!1,contentType:!1,beforeSend:function(){s.text(user_registration_advanced_fields_params.uraf_profile_picture_uploading),s.closest(".ur-frontend-form").find(".ur-submit-button").prop("disabled",!0)},complete:function(e){var r,t="",i=0;s.closest(".ur-frontend-form").find(".ur-submit-button").prop("disabled",!1),o.parent().parent().parent().find(".user-registration-error").remove(),o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-input").val("");try{var a=JSON.parse(e.responseText);if("undefined"==typeof a.success||"undefined"==typeof a.data)throw user_registration_advanced_fields_params.uraf_profile_picture_something_wrong;t=a.data.message,a.success||(t='<p class="uraf-profile-picture-error user-registration-error">'+t+"</p>"),a.success&&(t="",i=a.data.attachment_id,r=a.data.profile_picture_url,f(".user-registration-img-container").find(".profile-preview").attr("src",r),o.closest(".uraf-profile-picture-upload").find(".profile-preview").attr("src",r))}catch(n){t=user_registration_advanced_fields_params.uraf_profile_picture_something_wrong}o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-remove").attr("data-attachment-id",a.data.attachment_id).removeAttr("style"),o.closest(".uraf-profile-picture-upload").find(".wp_uraf_take_snapshot ").attr("style","display:none"),o.closest(".uraf-profile-picture-upload").find(".wp_uraf_profile_picture_upload ").attr("style","display:none"),o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-error").remove(),o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-file-error").remove(),o.closest(".uraf-profile-picture-upload").append('<span class="uraf-profile-picture-file-error">'+t+"</span>"),0<i&&o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-input").val(a.data.upload_files),s.text(l)}})},crop_image:function(r){var t;f(document.body).hasClass("theme-twentytwentytwo")&&f("#crop_container,.jcrop-holder, .jcrop-tracker").css({width:"400px",heigth:"400px"}),f("#crop_container").Jcrop({aspectRatio:1,boxWidth:400,boxHeight:400,onSelect:function(e){t={x:e.x,y:e.y,w:e.w,h:e.h}},setSelect:[100,100,50,50]}),f(".swal2-confirm").on("click",function(){var e={x:t.x,y:t.y,w:t.w,h:t.h,holder_width:f("#crop_container").css("width"),holder_height:f("#crop_container").css("height")};f(".cropped_image_size").val(JSON.stringify(e)),a.send_file(r,"")})},remove_avatar:function(e){var r=e.text(),t=e.data("attachment-id");e.closest(".uraf-profile-picture-upload").find(".ur_removed_profile_pic").length<=0&&((i=document.createElement("input")).setAttribute("type","hidden"),i.setAttribute("class","ur_removed_profile_pic"),i.setAttribute("name","ur_removed_profile_pic"),i.setAttribute("value",""),e.closest(".uraf-profile-picture-upload").append(i));var i=e.closest(".uraf-profile-picture-upload").find(".ur_removed_profile_pic").val(),i=new Set(i?JSON.parse(i):[]);i.add(t),e.closest(".uraf-profile-picture-upload").find(".ur_removed_profile_pic").val(JSON.stringify(Array.from(i))),e.text(user_registration_advanced_fields_params.uraf_profile_picture_removing),e.closest(".uraf-profile-picture-upload").find("#ur-profile-pic").val(""),e.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-input").val(""),e.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-file-error").remove(),f(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g"),e.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-remove").data("attachment-id",""),e.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-remove").attr("style","display:none"),e.closest(".uraf-profile-picture-upload").find(".wp_uraf_take_snapshot ").removeAttr("style"),e.closest(".uraf-profile-picture-upload").find(".wp_uraf_profile_picture_upload ").removeAttr("style"),e.closest(".uraf-profile-picture-upload").find(".uraf_profile_pic_file").remove(),e.closest(".uraf-profile-picture-upload").find('input[type="file"]').off("click"),e.text(r)},init_event:function(){a.handle_profile_picture_upload(),a.handle_range_field()},handle_profile_picture_upload:function(){f("body").on("change",'.uraf-profile-picture-upload-node input[type="file"]',function(){if(this.files&&this.files[0]){var e=this.files[0];if(-1===user_registration_advanced_fields_params.uraf_default_profile_picture_valid_file_types.split(",").indexOf(e.type))return f(this).closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-error").remove(),void f(this).closest(".uraf-profile-picture-upload").append('<p class="uraf-profile-picture-error user-registration-error">'+user_registration_advanced_fields_params.uraf_profile_picture_invalid_file_type_error_text+"</p>");e=new FileReader;e.onload=function(e){f(".img").attr("src",e.target.result)},e.readAsDataURL(this.files[0]),f("#ur-profile-pic").data("crop-picture")?(Swal.fire({title:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button,customClass:{container:"user-registration-swal2-container"}}),f(".swal2-cancel ").on("click",function(){f(".uraf-profile-picture-upload").find("#ur-profile-pic").val("")}),a.crop_image(f(this))):a.send_file(f(this),"")}}),f(document).on("click",".wp_uraf_profile_picture_upload",function(){f(this).closest(".uraf-profile-picture-upload").find('input[type="file"]').trigger("click")}),f(document).on("click",".wp_uraf_take_snapshot",function(){var r=f(this);Swal.fire({title:user_registration_advanced_fields_params.uraf_profile_picture_capture,html:'<div id="my_camera"></div>',confirmButtonText:user_registration_advanced_fields_params.uraf_profile_picture_capture,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button,customClass:{container:"user-registration-swal2-container"}});var e=320,t=240;f(window).width()<f(window).height()&&(e=240,t=320),Webcam.set({width:e,height:t,dest_width:e,dest_height:t,crop_width:e,crop_height:t,image_format:"jpeg",jpeg_quality:90});var i=!1;Webcam.on("error",function(e){var r="",t="",t="WebcamError"===e.name?(r=user_registration_advanced_fields_params.uraf_profile_picture_ssl_error_title,user_registration_advanced_fields_params.uraf_profile_picture_ssl_error_text):(r=user_registration_advanced_fields_params.uraf_profile_picture_permission_error_title,user_registration_advanced_fields_params.uraf_profile_picture_permission_error_text);i=!0,swal.fire({icon:"warning",title:r,html:t,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button_confirmation,cancelButtonColor:"#236bb0",customClass:{container:"user-registration-swal2-container"}})}),i||(Webcam.attach("#my_camera"),f(".swal2-confirm").on("click",function(){Webcam.snap(function(e){f("#ur-profile-pic").data("crop-picture")?(Swal.fire({title:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button,customClass:{container:"user-registration-swal2-container"}}),f("#crop_container").attr("src",e),a.crop_image(r.closest(".uraf-profile-picture-upload").find('.uraf-profile-picture-upload-node input[type="file"]'))):a.send_file(r.closest(".uraf-profile-picture-upload").find('.uraf-profile-picture-upload-node input[type="file"]'),e)}),Webcam.reset()}),f(".swal2-cancel").on("click",function(){Webcam.reset()}))}),f(document).on("click",".uraf-profile-picture-remove",function(){a.remove_avatar(f(this))})},handle_range_field:function(){f(".ur-range-slider").each(function(){var e=f(this),r=f(this).closest(".ur-range-row").find(".ur-range-input"),t=f(this).closest(".ur-range-row").find(".ur-range-slider-reset-icon"),i=e.val();r.val(i),e.on("change",function(){var e=f(this).val();r.val(e),a.render_range_bubble(f(this))}),r.on("change",function(){e.val(f(this).val()),a.render_range_bubble(e)}),t.on("click",function(){e.val(i),r.val(i),a.render_range_bubble(e)}),"readonly"===e.attr("readonly")&&f(".ur-range-number").remove()})},render_range_bubble:function(e){var r,t=e.attr("max"),i=e.attr("min"),a=t-i,t=(e.val()-i)/a,i=e.width(),a=-1;t<0?r=0:1<t?r=i:(r=i*t+a,a-=t),e.next("output").css({left:r,marginLeft:a+"%"}).text(e.val()).show().trigger("change")},profile_picture_field_reset_after_ajax:function(e){e.find("#ur-profile-pic").val(""),f(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g"),e.find(".uraf-profile-picture-remove").data("attachment-id",""),e.find(".uraf-profile-picture-remove").attr("style","display:none"),e.find(".wp_uraf_take_snapshot ").removeAttr("style"),e.find(".wp_uraf_profile_picture_upload ").removeAttr("style"),e.find('input[type="file"]').off("click")}};function c(e){if(e){e=e.match(/(\d+):(\d+)\s*([ap]m)/i);return{hours:parseInt(e[1]),minutes:parseInt(e[2]),ampm:e[3]}}}a.init(jQuery),jQuery(document).ready(function(){jQuery(".input-timepicker").each(function(){var e=f(this),t=e.data("time-interval"),r=e.data("time-min"),i=e.data("time-max"),a=e.data("time-format"),n=e.data("time-range"),o=f(this).closest(".user-registration-EditProfileForm").length<1&&e.data("current-time");o&&(u=(new Date).toLocaleString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),i<u&&(o=!1));var s,l,u,p="";void 0===t&&(t=30),"AM"==r||"PM"==r?r="00:00":r&&(l=c(r),minAmpm=l.ampm,r=l.hours+":"+l.minutes,minAmpm=minAmpm.toLowerCase(),"pm"===minAmpm&&l.hours<12&&(minHour=l.hours+12,r=minHour+":"+l.minutes)),"AM"==i||"PM"==i?i="23:59":i&&(l=c(i),maxAmpm=l.ampm,i=l.hours+":"+l.minutes,maxAmpm=maxAmpm.toLowerCase(),"pm"===maxAmpm&&l.hours<12&&(maxHour=l.hours+12,i=maxHour+":"+l.minutes)),n&&e.on("change",function(){var e=f(this).hasClass("timepicker-start")?f(this):f(this).siblings(".timepicker-start"),r=f(this).hasClass("timepicker-end")?f(this):f(this).siblings(".timepicker-end");s=e.val();e="";(""==(p=r.val())||p<s)&&(p=s&&"H:i"==a?(e=function(e){if(e){e=e.match(/(\d+):(\d+)/);return{hours:parseInt(e[1]),minutes:parseInt(e[2])}}}(s),startHour=e.hours,startMinutes=e.minutes,startMinutes+=t,startHour+":"+startMinutes):(e=c(s),startHour=e.hours,startMinutes=e.minutes,startAmPm=e.ampm,startMinutes+=t,startHour+":"+startMinutes+startAmPm),i<p&&r.val(i),r.val(p),f(this).siblings(".timepicker-time").val(s+" to "+p),r.flatpickr({enableTime:!0,noCalendar:!0,dateFormat:a,minTime:s,maxTime:i,minuteIncrement:t,time_24hr:"H:i"==a,defaultDate:p||""})),f(this).siblings(".timepicker-time").val(s+" to "+p),f(this).closest(".ur-timepicker-range").siblings(".user-registration-timepicker-same-time-error").remove(),f(this).closest(".ur-frontend-form").find(".ur-submit-button").prop("disabled",!1),s===p&&(f(this).closest(".ur-frontend-form").find(".ur-submit-button").prop("disabled",!0),r.closest(".ur-timepicker-range").after('<label id="user_timepicker-error" class="user-registration-error user-registration-timepicker-same-time-error" for="ur-timepicker">'+user_registration_advanced_fields_params.uraf_timepicker_same_time_error_message+"</label>"))}),e.flatpickr({enableTime:!0,noCalendar:!0,dateFormat:a,defaultDate:o?new Date:"",minTime:r,maxTime:i,minuteIncrement:t,time_24hr:"H:i"==a}),o&&(e.timepicker("setTime",new Date),u=(new Date).toLocaleString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),f(this).closest(".ur-timepicker-range").find(".timepicker-time").val(u+" to "+u))}),f(".ur-frontend-form").find("form.edit-profile").hasClass("user-registration-EditProfileForm")&&f(".ur-smart-phone-field").each(function(e,r){var t=f(r),r=t.val();t.siblings('input[type="hidden"]').val(r)}),jQuery(".ur-field-item.field-select2 select, .ur-field-item.field-multi_select2 select, select.ur-field-profile-select2").selectWoo(),f.fn.select2.amd.define("select2/selectAllAdapter",["select2/utils","select2/dropdown","select2/dropdown/attachBody"],function(e,r,t){function i(){}return i.prototype.render=function(e){var i=this,e=e.call(this);return $selectAll=f('<a class="button-check-all" >'+user_registration_advanced_fields_params.uraf_select_all+"</a>"),$unselectAll=f('<a class="button-check-all">'+user_registration_advanced_fields_params.uraf_unselect_all+"</a>"),$btnContainer=f("<div>").append($selectAll).append($unselectAll),e.find(".select2-dropdown").prepend($btnContainer),$selectAll.on("click",function(e){var r=i.$element.find("option"),t=[];r.each(function(){t.push(f(this).val())}),i.$element.val(t),i.$element.trigger("change"),i.trigger("close")}),$unselectAll.on("click",function(e){i.$element.val([]),i.$element.trigger("change"),i.trigger("close")}),e},e.Decorate(e.Decorate(r,t),i)}),f("select[data-check-all=1]").select2({placeholder:"",dropdownAdapter:f.fn.select2.amd.require("select2/selectAllAdapter")})}),f(document).on("user_registration_frontend_after_ajax_complete",function(e,r,t,i){"message"===t&&a.profile_picture_field_reset_after_ajax(i)})};e(jQuery),f(document).on("elementor/popup/show",function(){f(document).off("click",".wp_uraf_profile_picture_upload"),e(jQuery)}),f(".field-wysiwyg").each(function(){var e=f(this);"readonly"===e.find("input").attr("readonly")&&e.find(".wp-core-ui").css("pointer-events","none")}),f(window).bind("beforeunload",function(e){f(".ur-frontend-form ").each(function(){0===f(this).find(".edit-profile").length&&0<f(this).find(".uraf-profile-picture-upload").length&&f(this).find(".uraf-profile-picture-remove").trigger("click")})})});